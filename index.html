<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Annilyser &lt;&apos;&gt;</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <style>

    </style>

    <script src="./js/d3.v5.min.js"></script>
    <script src="./js/classes_short.js"></script>
    <script src="./html-src/icons.js"></script>
    <script src="./html-src/annilyser-logo.js"></script>
    <link rel="stylesheet" href="./index.css">
    <!-- <script src="./dev/samplelog.js"></script> -->
    <!-- DEVELOPMENT SAMPLE LOG: DataDUMMY-->


    <style>
        .links line {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        
        .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        
        text {
            font-family: sans-serif;
            font-size: 10px;
        }
    </style>

</head>

<body onresize="windowresize()">

    <!-- content -->

    <div class="firstline">
        <!-- <div id="head-a">x</div>
        <div id="head-b">x</div> -->
        <svg id="annilyser-logo" x="0" y="0" height="100"></svg>
    </div>
    <!-- colums -->
    <div class="secondline secondA">
        <div id="slot-b"></div>
        <div id="slot-c"></div>
        <div id="slot-d"></div>
    </div>
    <div class="secondline secondB">
        <div id="slot-e"></div>
        <div id="slot-f"></div>
        <div id="slot-g"></div>
        <div id="slot-h"></div>
    </div>
    <div class="secondline secondC">
        <div id="slot-i"></div>
        <div id="slot-j"></div>
    </div>
    <!-- colums -->
    <div class="thirdline">
        <div id="slot-k"></div>
        <div id="slot-l"></div>
        <div id="slot-m"></div>

    </div>
</body>






<script>
    //memo:
    //https://jsonformatter.curiousconcept.com/

    // const url = 'json/muster_neu.json';

    // http://localhost:1138/app/api/path/in/set/?p=pfad/zum/inputlog
    // http://localhost:1138/app/api/path/out/set/?p=pfad/zum/outputlog

    // http://localhost:1138/app/api/start
    // http://localhost:1138/app/api/path/in/get
    // http://localhost:1138/app/api/path/out/get

    // java -jar annilyser-main-0.0.3.jar

    // §9 = blau
    // §a = grün
    // §c = rot
    // §e = gelb

    const url = 'http://localhost:1138/app/api/gameState';


    const init_slots = {

        "slot-b": {},
        "slot-c": {},
        "slot-d": {},
        "slot-e": {
            "id": "slot-e",
            "graphname": "crosspie",
            "init": "crosspie",
            "labels": "Crosspie",
            "margin": {
                "top": 30,
                "right": 30,
                "bottom": 32,
                "left": 35
            }
        },

        "slot-f": {
            "id": "slot-f",
            "graphname": "nexusradar",
            "init": "nexusradar",
            "labels": "Radar",
            "margin": {
                "top": 10,
                "right": 10,
                "bottom": 12,
                "left": 15
            }
        },
        "slot-g": {
            "id": "slot-g",
            "graphname": "menlist",
            "init": "menlist",
            "labels": "Menlist",
            "margin": {
                "top": 10,
                "right": 10,
                "bottom": 12,
                "left": 15
            }
        },
        "slot-h": {
            "id": "slot-h",
            "graphname": "kdscore",
            "init": "scatter",
            "labels": "Kills & Deathes",
            "margin": {
                "top": 10,
                "right": 10,
                "bottom": 12,
                "left": 15
            }
        },
        "slot-i": {},
        "slot-j": {},
        "slot-k": {
            "id": "slot-k",
            "graphname": "doubledonut",
            "init": "doubledonut",
            "kind": "team",
            "margin": {
                "top": 10,
                "right": 10,
                "bottom": 12,
                "left": 30
            },
            "dataselection": [{
                "group": "datagroup0",
                "place": "top",
                "startangle": -0.5 * Math.PI,
                "endangle": 0.5 * Math.PI,
                "scale": 1,
                "size": "big",
                "ra": "absolut",
                "kd": "kills",
                "tmb": "total"
            }, {
                "group": "datagroup1",
                "place": "bottom",
                "startangle": -0.5 * Math.PI,
                "endangle": -1.5 * Math.PI,
                "scale": 1,
                "size": "big",
                "ra": "absolut",
                "kd": "deaths",
                "tmb": "total"
            }, {
                "group": "datagroup2",
                "place": "top",
                "startangle": 1 * Math.PI,
                "endangle": -1 * Math.PI,
                "scale": 0.2,
                "size": "small",
                "ra": "absolut",
                "kd": "kills",
                "tmb": "bow"
            }, {
                "group": "datagroup3",
                "place": "bottom",
                "startangle": -2 * Math.PI,
                "endangle": 2 * Math.PI,
                "scale": 0.2,
                "size": "small",
                "ra": "absolut",
                "kd": "kills",
                "tmb": "melee"
            }, {
                "group": "datagroup4",
                "place": "top",
                "startangle": 1 * Math.PI,
                "endangle": -1 * Math.PI,
                "scale": 0.2,
                "size": "small",
                "ra": "absolut",
                "kd": "deaths",
                "tmb": "bow"
            }, {
                "group": "datagroup5",
                "place": "bottom",
                "startangle": -2 * Math.PI,
                "endangle": 2 * Math.PI,
                "scale": 0.2,
                "size": "small",
                "ra": "absolut",
                "kd": "deaths",
                "tmb": "melee"
            }]
        },
        "slot-l": {},
        "slot-m": {
            "id": "slot-m",
            "graphname": "nodegraph",
            "init": "nodegraph",
            "labels": "Nodegraph",
            "margin": {
                "top": 10,
                "right": 10,
                "bottom": 10,
                "left": 10
            }
        }
    };

    // LATER !!!!!!!!!!!!!!

    // var graph = {
    //     'nodes': {
    //         '0': {
    //             'id': "Myriel",
    //             'group': 1
    //         },
    //         '1': {
    //             'id': "Napoleon",
    //             'group': 1
    //         },
    //         '2': {
    //             'id': "Mlle.Baptistine",
    //             'group': 1
    //         },
    //         '3': {
    //             'id': "Mme.Magloire",
    //             'group': 1
    //         },
    //         '4': {
    //             'id': "CountessdeLo",
    //             'group': 1
    //         },
    //         5: {
    //             'id': "Geborand",
    //             'group': 1
    //         },
    //         6: {
    //             'id': "Champtercier",
    //             'group': 1
    //         },
    //         7: {
    //             'id': "Cravatte",
    //             'group': 1
    //         },
    //         8: {
    //             'id': "Count",
    //             'group': 1
    //         },
    //         9: {
    //             'id': "OldMan",
    //             'group': 1
    //         },
    //         10: {
    //             'id': "Labarre",
    //             'group': 2
    //         },
    //         11: {
    //             'id': "Valjean",
    //             'group': 2
    //         },
    //         12: {
    //             'id': "Marguerite",
    //             'group': 3
    //         },
    //         13: {
    //             'id': "Mme.deR",
    //             'group': 2
    //         },
    //         14: {
    //             'id': "Isabeau",
    //             'group': 2
    //         },
    //         15: {
    //             'id': "Gervais",
    //             'group': 2
    //         },
    //         16: {
    //             'id': "Tholomyes",
    //             'group': 3
    //         },
    //         17: {
    //             'id': "Listolier",
    //             'group': 3
    //         },
    //         18: {
    //             'id': "Fameuil",
    //             'group': 3
    //         },
    //         19: {
    //             'id': "Blacheville",
    //             'group': 3
    //         }
    //     },
    //     'links': {
    //         0: {
    //             'source': "Napoleon",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         1: {
    //             'source': "Mlle.Baptistine",
    //             'target': "Myriel",
    //             'value': 8
    //         },
    //         2: {
    //             'source': "Mme.Magloire",
    //             'target': "Myriel",
    //             'value': 10
    //         },
    //         3: {
    //             'source': "Mme.Magloire",
    //             'target': "Mlle.Baptistine",
    //             'value': 6
    //         },
    //         4: {
    //             'source': "CountessdeLo",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         5: {
    //             'source': "Geborand",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         6: {
    //             'source': "Champtercier",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         7: {
    //             'source': "Cravatte",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         8: {
    //             'source': "Count",
    //             'target': "Myriel",
    //             'value': 2
    //         },
    //         9: {
    //             'source': "OldMan",
    //             'target': "Myriel",
    //             'value': 1
    //         },
    //         10: {
    //             'source': "Valjean",
    //             'target': "Labarre",
    //             'value': 1
    //         },
    //         11: {
    //             'source': "Valjean",
    //             'target': "Mme.Magloire",
    //             'value': 3
    //         },
    //         12: {
    //             'source': "Valjean",
    //             'target': "Mlle.Baptistine",
    //             'value': 3
    //         },
    //         13: {
    //             'source': "Valjean",
    //             'target': "Myriel",
    //             'value': 5
    //         },
    //         14: {
    //             'source': "Marguerite",
    //             'target': "Valjean",
    //             'value': 1
    //         },
    //         15: {
    //             'source': "Mme.deR",
    //             'target': "Valjean",
    //             'value': 1
    //         },
    //         16: {
    //             'source': "Isabeau",
    //             'target': "Valjean",
    //             'value': 1
    //         },
    //         17: {
    //             'source': "Gervais",
    //             'target': "Valjean",
    //             'value': 1
    //         },
    //         18: {
    //             'source': "Listolier",
    //             'target': "Tholomyes",
    //             'value': 4
    //         },
    //         19: {
    //             'source': "Fameuil",
    //             'target': "Tholomyes",
    //             'value': 4
    //         }
    //     }
    // }


    var nexusRadarGameSec = 0;




    init();


    var getJson = () => {

        fetch(url)
            .then(
                function(response) {

                    if (response.status !== 200) {
                        // console.log('Looks like there was a problem. Status Code: ' + response.status);
                        return;
                    }

                    response.json().then(function(data) {
                        // console.log("json data: ", data);
                        // console.log("json data: ", dataDUMMY);
                        // document.getElementById("output").innerHTML = JSON.stringify(data);


                        // dataDUMMY = data;




                        // data.killsDeath.data[4].relative.kills.total += Math.floor(Math.random() * Math.floor(2));

                        // dataDUMMY.killsdeath.data[4].relative.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[4].relative.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[5].relative.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[5].relative.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[6].relative.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[6].relative.deaths.total += Math.floor(Math.random() * Math.floor(2));

                        // dataDUMMY.killsdeath.data[0].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[1].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[2].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[3].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));

                        // dataDUMMY.killsdeath.data[0].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[1].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[2].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[3].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));

                        // dataDUMMY.killsdeath.data[7].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[8].absolut.kills.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[7].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));
                        // dataDUMMY.killsdeath.data[8].absolut.deaths.total += Math.floor(Math.random() * Math.floor(2));

                        // data.gamestate.teamvsteam = dataDUMMY.teamvsteam;



                        // console.log("json data: ", data);
                        // console.log("json data: ", dataDUMMY);

                        update(data.gameState);
                        // update(dataDUMMY);



                    });
                }
            )
            .catch(function(err) {
                console.log('Oh NOOOOO .... CatchFetch Error:', err);
            });
    }

    window.setInterval(function() {
        getJson();
    }, 1000);




    function windowresize() {

        console.log("rezise");

        Object.keys(init_slots).forEach(function(key, _) {
            // if (init_slots[key] === 'linechart') initLinechart(graphic, key);

            let o = document.getElementById(key).getClientRects()[0];
            // console.log(o);
            // console.log(document.getElementById(key).clientHeight);
            // console.log(document.getElementById(key).offsetHeight);

            d3.select('#svg-' + key)
                // .attr('id', 'svg-' + key)
                // .attr('width', '100%')
                // .attr('height', '100%')
                .attr('pwidth', o.width)
                .attr('pheight', o.height);
        })


    }



    function update(data) {
        // console.log('update');
        Object.keys(init_slots).forEach(function(key, _) {
            // if (init_slots[key].graphname) console.log('update:', init_slots[key].graphname);

            if (init_slots[key].graphname == 'kdscore') update_kdscore(init_slots[key], data.killsDeath);
            if (init_slots[key].graphname == 'doubledonut') update_doubledonut(init_slots[key], data.killsDeath, init_slots[key].dataselection);
            if (init_slots[key].graphname == 'nexusradar') update_nexusradar(init_slots[key], data.nexusradar, init_slots[key].dataselection);
            // if (init_slots[key].graphname == 'crosspie') update_crosspie(init_slots[key], data.teamvsteam, init_slots[key].dataselection);
            // if (init_slots[key].graphname == 'nodegraph') update_nodes(init_slots[key], data.teamvsteam, init_slots[key].dataselection);
        });
    }

    // LATER !!!!!!!!!!!!!!!!!!!!!!!!!!!

    // function update_nodes(settings, data, dataselection) {

    //     const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
    //     const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");

    //     const w = fullW - settings.margin.left - settings.margin.right - 0;
    //     const h = fullH - settings.margin.top - settings.margin.bottom - 0;
    //     // const h = fullW - settings.margin.top - settings.margin.bottom - 0;
    //     // const h = fullH - settings.margin.top - settings.margin.bottom - 0;
    //     // const svg = d3.select('#' + 'svg-' + settings.id);

    //     const storkeWidth = 0.5;
    //     // const list = d3.select('#' + 'svg-' + settings.id);

    //     const team = ['red', 'green', 'blue', 'yellow'];
    //     const space = w / team.length;

    //     // list.append('rect').attr('width', fullW).attr('height', fullH).classed('background', true);

    //     // const datafield = d3.select('#' + 'svg-' + settings.id).append('g').classed('datafield', true)
    //     //     .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")



    //     // const nodes = d3.select('#' + 'svg-' + settings.id + ' .datafield');

    //     // nodes.append('circle')
    //     //     .attr('r', 10)


    //     // function dragstarted(d) {
    //     //     if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    //     //     d.fx = d.x;
    //     //     d.fy = d.y;
    //     // }

    //     // function dragged(d) {
    //     //     d.fx = d3.event.x;
    //     //     d.fy = d3.event.y;
    //     // }

    //     // function dragended(d) {
    //     //     if (!d3.event.active) simulation.alphaTarget(0);
    //     //     d.fx = null;
    //     //     d.fy = null;
    //     // }


    //     // // var svg = d3.select('#' + 'svg-' + settings.id),
    //     // var svg = d3.select('#' + 'svg-' + settings.id),
    //     //     width = +svg.attr("width"),
    //     //     height = +svg.attr("height");

    //     // var color = d3.scaleOrdinal(d3.schemeCategory10);

    //     // var simulation = d3.forceSimulation()
    //     //     .force("link", d3.forceLink().id(function(d) {
    //     //         return d.id;
    //     //     }))
    //     //     .force("charge", d3.forceManyBody())
    //     //     .force("center", d3.forceCenter(width / 2, height / 2));






    //     // var link = svg.append("g")
    //     //     .attr("class", "links")
    //     //     .selectAll("line")
    //     //     .data(graph.links)
    //     //     .enter().append("line")
    //     //     .attr("stroke-width", function(d) {
    //     //         return Math.sqrt(d.value);
    //     //     });

    //     // var node = svg.append("g")
    //     //     .attr("class", "nodes")
    //     //     .selectAll("g")
    //     //     .data(graph.nodes)
    //     //     .enter().append("g")

    //     // var circles = node.append("circle")
    //     //     .attr("r", 5)
    //     //     .attr("fill", function(d) {
    //     //         return color(d.group);
    //     //     })
    //     //     .call(d3.drag()
    //     //         .on("start", dragstarted)
    //     //         .on("drag", dragged)
    //     //         .on("end", dragended));

    //     // // var lables = node.append("text")
    //     // //     .text(function(d) {
    //     // //         return d.id;
    //     // //     })
    //     // //     .attr('x', 6)
    //     // //     .attr('y', 3);

    //     // // node.append("title")
    //     // //     .text(function(d) {
    //     // //         return d.id;
    //     // //     });

    //     // simulation
    //     //     .nodes(graph.nodes)
    //     //     .on("tick", ticked);

    //     // simulation.force("link")
    //     //     .links(graph.links);

    //     // function ticked() {
    //     //     link
    //     //         .attr("x1", function(d) {
    //     //             return d.source.x;
    //     //         })
    //     //         .attr("y1", function(d) {
    //     //             return d.source.y;
    //     //         })
    //     //         .attr("x2", function(d) {
    //     //             return d.target.x;
    //     //         })
    //     //         .attr("y2", function(d) {
    //     //             return d.target.y;
    //     //         });

    //     //     node
    //     //         .attr("transform", function(d) {
    //     //             return "translate(" + d.x + "," + d.y + ")";
    //     //         })
    //     // }


    // }

    // LATER !!!!!!!!!!!!!

    // function update_crosspie(settings, data, dataselection) {

    //     const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
    //     const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
    //     const w = (fullW - settings.margin.left - settings.margin.right);
    //     const h = (fullH - settings.margin.top - settings.margin.bottom);


    //     const space = w / Object.keys(data.data).length;

    //     const team = ['red', 'green', 'blue', 'yellow', 'purple'];

    //     // console.log(Object.keys(data.data).length);

    //     var crosspie = d3.select('#' + 'svg-' + settings.id);


    //     Object.keys(team).forEach(function(vskey) {
    //         Object.keys(team).forEach(function(key) {

    //             // data.data

    //             if (team[key] != team[vskey]) {
    //                 crosspie.select('#' + team[key] + '-' + team[vskey])
    //                     .append('circle')
    //                     .attr('cx', space * 0.5)
    //                     .attr('cy', space * 0.5)
    //                     .attr('r', 5)
    //                     .attr('class', 'fill-' + team[key])
    //             }


    //             //     // console.log(team);
    //             //     crosspie.append('circle')
    //             //         .attr('r', space * 0.5)
    //             //         .attr('class', 'fill-' + team)
    //             //         .attr("transform", "translate(" + ((space * (key + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")

    //             //     crosspie.append('text')
    //             //         .text(data.data[team].playercount)
    //             //         .attr('class', 'crosspie-teamsize')
    //             //         .attr("transform", "translate(" + ((space * (key + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")


    //             //     Object.keys(data.data[team].absolut).forEach(function(vsteam, vskey) {

    //             //         crosspie.append('circle')
    //             //             // .attr('r', space * 0.5)
    //             //             .attr('r', 5)
    //             //             .attr('class', 'fill-' + team)
    //             //             .attr("transform", "translate(" + ((space * (key + 0.5 + vskey + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")


    //             //     })
    //         })
    //     })




    // }


    function update_nexusradar(settings, data, dataselection) {

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right;
        const h = fullH - settings.margin.top - settings.margin.bottom;

        var radar = d3.select('#' + settings.id + '-datafield');

        const sec = 60;
        const startR = 7;

        const t = d3.transition().duration(sec * 1000).ease(d3.easeLinear);

        // var lastgameSec = 0;
        var dataNew = {};

        radar.selectAll('circle[opacity="0"]').remove();

        const nexusPlace = {
            'red': [0, 0],
            'green': [1, 0],
            'blue': [0, 1],
            'yellow': [1, 1]
        }



        if (Object.keys(data).length > 0) {


            Object.keys(data).forEach(function(key, _) {
                if (+key > nexusRadarGameSec) {
                    dataNew[key] = data[key];
                    nexusRadarGameSec = +key;
                }
            });





            // // radar.attr('viewBox', '10 10 ' + w + ' ' + h + '')

            // // radar.html(`  <defs>
            // //     <clipPath id="cut-off-bottom">
            // //       <rect x="10" y="10" width="200" height="100" />
            // //     </clipPath>
            // //   </defs>`);

            // const color = ['red', 'green', 'blue', 'yellow'];
            // const t1 = Math.floor(Math.random() * Math.floor(2));
            // const t2 = Math.floor(Math.random() * Math.floor(2));
            // const c1 = Math.floor(Math.random() * Math.floor(4));
            // // const c2 = Math.floor(Math.random() * Math.floor(2));

            // // console.log("t12: ", t1, " ", t2);
            // // console.log("wh: ", w, " ", h);
            // //a[target="_blank"]




            if (Object.keys(dataNew).length > 0) {



                // console.log("nexusradar data: ", data);
                // console.log("nexusradar dataNew: ", dataNew);



                Object.keys(dataNew).forEach(function(gameSec, _) {
                    Object.keys(dataNew[gameSec]).forEach(function(teamNexus, _) {
                        Object.keys(dataNew[gameSec][teamNexus]).forEach(function(teamDeath, _) {

                            // console.log("xxx ->" + dataNew[gameSec][teamNexus][teamDeath]);


                            radar.append('circle')
                                .attr('cx', (w * nexusPlace[teamNexus][0]))
                                .attr('cy', (w * nexusPlace[teamNexus][1]))
                                .attr('r', startR)
                                .attr('class', 'stroke-' + teamDeath)
                                .attr('stroke-width', 2 * dataNew[gameSec][teamNexus][teamDeath])
                                .attr('fill', 'none')
                                .attr('opacity', 1)
                                .attr('clip-path', 'url(#cut-off-bottom)')
                                .transition(t)
                                .attr('stroke-width', 0.5)
                                .attr('r', w * 0.9)
                                .attr('opacity', 0)

                        });
                    });
                });
            }


        }


    }

    // function id(d) {
    //     return d;
    // }

    function id(d) {
        return "circle-" + d.kind.toLowerCase() + "-" + d.name.toLowerCase();
    }

    // settings.id + "-circle-" + d.kind.toLowerCase() + "-" + d.name.toLowerCase()


    function update_kdscore(settings, data) {

        // console.log("json kd data: ", data);
        // console.log("json settings: ", settings);
        // console.log("json data4: ", data.data[4].re 

        // dataDUMMY.killsdeath.data[4].absolut.kills.total

        // java -jar annilyser-main-0.0.5-SNAPSHOT.jar

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right;
        const h = fullH - settings.margin.top - settings.margin.bottom;

        let scatter = d3.select('#' + 'svg-' + settings.id);

        var t = d3.transition().duration(1000).ease(d3.easeLinear);


        const dmax = d3.max(data.data, d => d.relative.deaths.total);
        const kmax = d3.max(data.data, d => d.relative.kills.total);
        // console.log("json max: ", max);

        const xScale = d3.scaleLinear()
            // .domain([data.meta.player.deathsmin, data.meta.player.deathsmax])
            .domain([0, dmax + 1])
            // .range([settings.margin.left, w]);
            .range([0, w]);
        const yScale = d3.scaleLinear()
            // .domain([data.meta.player.killsmax, data.meta.player.killsmin])
            .domain([kmax + 1, 0])
            .range([0, h]);

        scatter.select("#" + settings.id + "-yAxis").transition(t)
            .attr("transform", "translate(" + (w + +settings.margin.left) + "," + (settings.margin.top) + ")")
            .call(d3.axisLeft(yScale).tickSize(w));

        scatter.select("#" + settings.id + "-xAxis").transition(t)
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top) + ")")
            .call(d3.axisBottom(xScale).tickSize(h));

        // var dataset = [];
        // Object.keys(data.data).forEach(function(key, _) {
        //     if (data.data[key].kind == 'player') dataset.push(data.data[key]);
        // });

        // console.log(dataset);

        // var xxx = d3.keys(data.data);
        // console.log("datas with keys: ", xxx);


        // console.log("#" + settings.id + "-circles");




        // var circles = scatter.select("#" + settings.id + "-circles").selectAll('circle')
        var circles = scatter.select("#" + settings.id + "-circles").selectAll('circle')
            .data(data.data, id);
        // .data(data.data);
        circles.exit().remove();

        circles.enter()
            .append('circle')
            .attr('cy', d => yScale(0)) // to start in the lower Left corner
            .merge(circles).transition(t)
            .attr('id', d => settings.id + "-circle-" + d.kind.toLowerCase() + "-" + d.name.toLowerCase())
            .attr('cx', d => xScale(d.relative.deaths.total))
            .attr('cy', d => yScale(d.relative.kills.total))
            .attr('class', d => d.kind.toLowerCase() + '-scatterdott ' + d.kind.toLowerCase() + '-scatterdott-' + d.group.toLowerCase())
            // .attr('r', '5')


        var dataset = [];
        Object.keys(data.data).forEach(function(key, _) {
            if (data.data[key].kind == 'CLASS') dataset.push(data.data[key]);
        });

        // console.log(dataset);

        var icons = scatter.select("#" + settings.id + "-icons").selectAll('g').data(dataset);

        icons.enter()
            .append('g')
            .merge(icons)
            .attr('id', d => settings.id + "-icon-wrapper-" + d.name.toLowerCase())
            .html(d => icon[d.name.toLowerCase()])
            .attr("transform", d => "translate(" + (xScale(d.relative.deaths.total) - 7) + "," + (yScale(d.relative.kills.total) - 7) + ") scale(0.09,0.09)")
            // .on("mouseover", console.log('over'))
            // .on("mousemove", console.log('move'))
            // .on("mouseleave", console.log('leave'))

        icons.exit().remove();

        // var names = scatter.select("#" + settings.id + "-names").selectAll('text').data(data.data);

        // names.enter()
        //     .append('text')
        //     .merge(names)
        //     .transition(t)
        //     .text(d => d.name)
        //     .attr('x', d => xScale(d.relative.deaths.total))
        //     .attr('y', d => yScale(d.relative.kills.total))
        //     // .classed('scatterdotttext', true)
        //     .attr('class', 'scatterdotttext')
        //     .attr('text-anchor', 'middle')
        //     // .html(d => {
        //     //     return icon[d.name.toLowerCase()];
        //     // })
        //     // .attr("transform", d => {
        //     //     return "translate(" + (xScale(d.relative.deaths.total) - 7) + "," + (yScale(d.relative.kills.total) - 7) + ") scale(0.15,0.15)"
        //     // });

        // names.exit().remove();
    }



    function update_doubledonut(settings, data, dataselection) {
        update_halfdonut(settings, data, dataselection[0]);
        update_halfdonut(settings, data, dataselection[1]);
        update_halfdonut(settings, data, dataselection[2]);
        update_halfdonut(settings, data, dataselection[3]);
        update_halfdonut(settings, data, dataselection[4]);
        update_halfdonut(settings, data, dataselection[5]);
    }


    function update_halfdonut(settings, data, dataselection) {

        // console.log("json update dd: ", data);
        // console.log("json update settings: ", settings);
        // console.log("json update dataselection: ", dataselection);

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = (fullW - settings.margin.left - settings.margin.right) * dataselection.scale;
        const h = (fullH - settings.margin.top - settings.margin.bottom) * dataselection.scale;

        var radius = Math.min(w, h) / 2;
        var sum = 0;
        var max = 0;
        var percentsum = 0;
        var percentcorrection;

        var dataset = [];
        // var pie;

        const midAngle = d => d.startAngle + (d.endAngle - d.startAngle) * 0.5;

        var t = d3.transition().duration(1000).ease(d3.easeLinear);

        Object.keys(data.data).forEach(function(key, _) {
            // if (data.data[key].kind == 'team') dataset.push(data.data[key]);
            if (data.data[key].kind.toLowerCase() == settings.kind) {
                // console.log("push: ", dataselection['ra'] + "," + dataselection['kd'] + "," + dataselection['tmb']);
                // console.log("push: ", data.data[key][dataselection['ra']][dataselection['kd']][dataselection['tmb']]);
                dataset.push({
                    "value": data.data[key][dataselection['ra']][dataselection['kd']][dataselection['tmb']],
                    "key": data.data[key].name.toLowerCase(),
                })
                sum += data.data[key][dataselection['ra']][dataselection['kd']][dataselection['tmb']];
                //solange die MAXWERTE nicht da sind
            };
        });

        Object.keys(dataset).forEach(function(key) {
            dataset[key]['percent'] = dataset[key].value * 100 / sum;
            dataset[key]['percentfloor'] = Math.floor(dataset[key].value * 100 / sum);
            dataset[key]['percentfloat'] = dataset[key]['percent'] - dataset[key]['percentfloor'];
            percentsum += dataset[key]['percentfloor'];
            max = (dataset[key]['percentfloat'] > max) ? dataset[key]['percentfloat'] : max;
        });

        percentcorrection = 100 - percentsum;

        Object.keys(dataset).forEach(function(key) {
            dataset[key]['percentcorrected'] = (max != dataset[key]['percentfloat']) ? dataset[key]['percentfloor'] + percentcorrection : dataset[key]['percentfloor'];
        });

        // console.log("json update dataset: ", dataset);

        var pie = d3.pie()
            .sort(null)
            .value(d => d.value)
            .startAngle(dataselection.startangle)
            .endAngle(dataselection.endangle);

        var dataset = pie(dataset)
        var ddonut = d3.select('#' + 'svg-' + settings.id);

        // console.log("inner pie: ", dataset);

        var a = ddonut.select('#' + dataselection.group + ' .donut').selectAll('path').data(dataset);



        a.enter()
            .append('path')
            .merge(a).transition(t)
            .attr('class', d => 'fill-' + d.data.key.toLowerCase() + ' ddonut-border')
            .attr('d',
                d3.arc()
                .innerRadius((dataselection.size == "big") ? radius * 0.5 : radius * 0.75)
                .outerRadius(radius))
            // .attr('class', d => 'team-ddonut-' + d.data.key.toLowerCase() + "-" + d.data.kind)
            // .attr('class', d => settings.kind + '-ddonut-' + d.data.key.toLowerCase() + ' fill-' + d.data.key.toLowerCase() + ' ddonut-border')

        a.exit().remove();




        var text0 = ddonut.select('#' + dataselection.group + ' .labelsbig').selectAll('text').data(dataset);

        text0.enter()
            .append('text')
            .merge(text0).transition(t)
            .attr("transform", function(d) {
                d.innerRadius = (dataselection.size == "big") ? radius * 0.5 : radius * 1.4;
                d.outerRadius = radius;
                return "translate(" + d3.arc().outerRadius(radius).centroid(d) + ")";
            })
            // .classed("team-ddonut-bigtext", true)
            .attr("class", "team-ddonut-" + dataselection.size + "text")
            .text(d => d.value)

        text0.exit().remove();

        var text1 = ddonut.select('#' + dataselection.group + ' .labelssmall').selectAll('text').data(dataset);

        text1.enter()
            .append('text')
            .merge(text1).transition(t)
            .attr("transform", function(d) {
                d.innerRadius = radius * 0.5;
                // d.innerRadius = (d.data.size == "big") ? radius / 2 : radius / 1.75;
                d.outerRadius = radius;
                return "translate(" + d3.arc().outerRadius(radius).centroid(d) + ")";
            })
            // .classed("team-ddonut-" + dataselection.size + "text-subline", true)
            .attr("class", "team-ddonut-" + dataselection.size + "text-subline")
            .text(d => d.data.percentcorrected + '%')

        text1.exit().remove();

        ddonut.select('#' + dataselection.group + ' .labels')
            .append('text')
            .classed("team-ddonut-" + dataselection.size + "-sum-" + dataselection.place, true)
            .text(sum)
            // percentcorrected

        // if (settings.kind.toLowerCase() == 'class' && dataselection.size == 'big') {

        //     var b = ddonut.select('#' + dataselection.group.toLowerCase() + ' .iconholder').selectAll('circle').data(dataset);

        //     b.enter()
        //         .append('circle')
        //         .merge(b).transition(t)
        //         .attr('class', "class-icon-circle")
        //         .attr("transform", d => {
        //             d.innerRadius = 0;
        //             d.outerRadius = radius;
        //             return "translate(" + d3.arc().outerRadius(radius).centroid(d) + ")";
        //         })
        //         .attr('cx', 0).attr('cy', 0).attr('r', 7)


        //     b.exit().remove();

        //     var c = ddonut.select('#' + dataselection.group.toLowerCase() + ' .icon').selectAll('g').data(dataset);

        //     c.enter()
        //         .append('g')
        //         .merge(c)
        //         .attr('id', d => d.data.key.toLowerCase())
        //         .attr("transform", d => {
        //             d.innerRadius = 0;
        //             d.outerRadius = radius;
        //             tl = d3.arc().outerRadius(radius).centroid(d);
        //             return "translate(" + (tl[0] - 3.5) + "," + (tl[1] - 3.5) + ") scale(0.075)";
        //         })
        //         .html(d => icon[d.data.key.toLowerCase()])

        //     c.exit().remove();

        // }


    }

    // LATER !!!!!!!!!!!!!!!!!!!!

    // function init_nodes(settings) {

    //     const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
    //     const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");

    //     const w = fullW - settings.margin.left - settings.margin.right - 0;
    //     const h = fullH - settings.margin.top - settings.margin.bottom - 0;
    //     // const h = fullW - settings.margin.top - settings.margin.bottom - 0;
    //     // const h = fullH - settings.margin.top - settings.margin.bottom - 0;
    //     // const svg = d3.select('#' + 'svg-' + settings.id);

    //     const storkeWidth = 0.5;
    //     // const list = d3.select('#' + 'svg-' + settings.id);

    //     // const team = ['red', 'green', 'blue', 'yellow'];
    //     // const space = w / team.length;

    //     // list.append('rect').attr('width', fullW).attr('height', fullH).classed('background', true);

    //     // const datafield = d3.select('#' + 'svg-' + settings.id).append('g').classed('datafield', true)
    //     //     .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")

    //     // datafield.append('rect')
    //     //     .attr('width', w - storkeWidth)
    //     //     .attr('height', h - storkeWidth)
    //     //     .classed('datarect', true)


    // }

    // LATER !!!!!!!!!!!

    // function init_menlist(settings) {

    //     const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
    //     const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");

    //     const w = fullW - settings.margin.left - settings.margin.right - 0;
    //     const h = fullW - settings.margin.top - settings.margin.bottom - 0;
    //     // const h = fullH - settings.margin.top - settings.margin.bottom - 0;
    //     // const svg = d3.select('#' + 'svg-' + settings.id);

    //     const storkeWidth = 0.5;
    //     const list = d3.select('#' + 'svg-' + settings.id);

    //     const team = ['red', 'green', 'blue', 'yellow'];
    //     const space = w / team.length;

    //     list.append('rect').attr('width', fullW).attr('height', fullH).classed('background', true);

    //     const datafield = d3.select('#' + 'svg-' + settings.id).append('g').classed('datafield', true)
    //         .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")

    //     datafield.append('rect')
    //         .attr('width', w - storkeWidth)
    //         .attr('height', h - storkeWidth)
    //         .classed('datarect', true)


    //     Object.keys(team).forEach(function(key) {


    //         if (key != 0) datafield.append('line').attr('x1', (space * key)).attr('y1', settings.margin.top + 10).attr('x2', (space * key)).attr('y2', w - 10).attr('class', 'menlist-sep')

    //         datafield.append('g')
    //             .attr('id', 'col-' + team[key])
    //             .attr("transform", "translate(" + ((space * key)) + "," + (settings.margin.top) + ")")

    //         datafield.select('#col-' + team[key])
    //             .append('text')
    //             .text(team[key].toUpperCase())
    //             .attr('class', 'fill-' + team[key] + ' team-text')
    //             .attr("transform", "translate(" + (space * 0.5) + "," + (settings.margin.top + w - 25) + ")")

    //     })

    // }

    function init_doubledonut(settings) {

        // console.log("json init dd: ", settings);

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right - 20;
        const h = fullH - settings.margin.top - settings.margin.bottom - 20;
        const space = 15;

        const svg = d3.select('#' + 'svg-' + settings.id);

        svg.append('rect').attr('width', fullW).attr('height', fullH).classed('background', true);


        if (settings.id == 'slot-k') {

            svg.append('text')
                .text('Kills')
                .attr('text-anchor', 'start')
                .classed('ddonut-text', true)
                .attr("transform", "translate(28," + ((h / 2) + 10) + ") rotate(-90 0,0)");

            svg.append('text')
                .text('Death')
                .attr('text-anchor', 'end')
                .classed('ddonut-text', true)
                .attr("transform", "translate(28," + ((h / 2) + 26) + ") rotate(-90 0,0)");
        }

        var ddonut = svg.append('g').attr("transform", "translate(15,0)");

        const datagroup0 = ddonut.append("g").attr("id", "datagroup0")
            .attr("transform", "translate(" + (settings.margin.left + (h / 2)) + "," + (settings.margin.top + (h / 2)) + ")");

        datagroup0.append("g").attr("class", "donut");
        datagroup0.append("g").attr("class", "labelsbig");
        datagroup0.append("g").attr("class", "labelssmall");
        datagroup0.append("g").attr("class", "iconholder");
        datagroup0.append("g").attr("class", "icon");
        datagroup0.append("g").append('text').classed("team-ddonut-headline-top", true)
            .text(settings.dataselection[0].tmb.toUpperCase() + " " + settings.dataselection[0].kd.toUpperCase());

        const datagroup1 = ddonut.append("g").attr("id", "datagroup1")
            .attr("transform", "translate(" + (settings.margin.left + (h / 2)) + "," + (settings.margin.top + (h / 2) + space) + ")");

        datagroup1.append("g").attr("class", "donut");
        datagroup1.append("g").attr("class", "labelsbig");
        datagroup1.append("g").attr("class", "labelssmall");
        datagroup1.append("g").attr("class", "iconholder");
        datagroup1.append("g").attr("class", "icon");
        datagroup1.append("g").append('text').classed("team-ddonut-headline-bottom", true)
            .text(settings.dataselection[1].tmb.toUpperCase() + " " + settings.dataselection[1].kd.toUpperCase());

        const datasubgroup = ddonut.append("g").attr("id", "datasubgroup")
            .attr("transform", "translate(" + (settings.margin.left + (h * 1.20)) + "," + (settings.margin.top) + ") ");

        const datagroup2 = datasubgroup.append("g").attr("id", "datagroup2")
            .attr("transform", "translate(0," + (((h - (settings.margin.top + settings.margin.bottom)) / 8) * 1) + ") ");
        datagroup2.append("g").attr("class", "donut");
        datagroup2.append("g").attr("class", "labelsbig");
        datagroup2.append("g").attr("class", "labelssmall");
        datagroup2.append("g").attr("class", "icon")
            .html(icon.bow)
            .attr("transform", "translate(-7,-8) scale(0.17) ");

        const datagroup3 = datasubgroup.append("g").attr("id", "datagroup3")
            .attr("transform", "translate(0," + (((h - (settings.margin.top + settings.margin.bottom)) / 8) * 3.2) + ") ");
        datagroup3.append("g").attr("class", "donut");
        datagroup3.append("g").attr("class", "labelsbig");
        datagroup3.append("g").attr("class", "labelssmall");
        datagroup3.append("g").attr("class", "icon")
            .html(icon.melee)
            .attr("transform", "translate(-8,-8) scale(0.17) ");

        const datagroup4 = datasubgroup.append("g").attr("id", "datagroup4")
            .attr("transform", "translate(0," + ((((h - (settings.margin.top + settings.margin.bottom)) / 8) * 5.4) + space + 5) + ") ");
        datagroup4.append("g").attr("class", "donut");
        datagroup4.append("g").attr("class", "labelsbig");
        datagroup4.append("g").attr("class", "labelssmall");
        datagroup4.append("g").attr("class", "icon")
            .html(icon.bow)
            .attr("transform", "translate(-7,-8) scale(0.17) ");

        const datagroup5 = datasubgroup.append("g").attr("id", "datagroup5")
            .attr("transform", "translate(0," + ((((h - (settings.margin.top + settings.margin.bottom)) / 8) * 7.6) + space + 5) + ") ");
        datagroup5.append("g").attr("class", "donut");
        datagroup5.append("g").attr("class", "labelsbig");
        datagroup5.append("g").attr("class", "labelssmall");
        datagroup5.append("g").attr("class", "icon")
            .html(icon.melee)
            .attr("transform", "translate(-8,-8) scale(0.17) ");
    }


    function init_scatter(settings) {

        // console.log("json data: ", settings);

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right;
        const h = fullH - settings.margin.top - settings.margin.bottom;

        let scatter = d3.select('#' + 'svg-' + settings.id);

        const xScale = d3.scaleLinear().domain([50, 0]).range([w - 10, 0]);
        const yScale = d3.scaleLinear().domain([0, 50]).range([h - 10, 0]);

        let storkeWidth = 0.5;

        scatter
            .append('rect')
            .attr('width', fullW)
            .attr('height', fullH)
            .classed('background', true);

        scatter
            .append('rect')
            .attr('width', w - storkeWidth)
            .attr('height', h - storkeWidth)
            .classed('datarect', true)
            .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")

        scatter.append("g").classed("yAxis", true).classed("axis", true)
            .attr('id', settings.id + "-yAxis")
            .attr("transform", "translate(" + (w + +settings.margin.left) + "," + (settings.margin.top) + ")")
            .call(d3.axisLeft(yScale).tickSize(w));

        scatter.append("g").classed("xAxis", true).classed("axis", true)
            .attr('id', settings.id + "-xAxis")
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top) + ")")
            .call(d3.axisBottom(xScale).tickSize(h));

        var datafield = scatter.append("g")
            .attr('id', settings.id + "-datafield")
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top) + ")")

        datafield.append("g").attr('id', settings.id + "-names")
        datafield.append("g").attr('id', settings.id + "-icons")
        datafield.append("g").attr('id', settings.id + "-circles")

    }

    function init_crosspie(settings) {

        // console.log("json data: ", settings);

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right;
        const h = fullH - settings.margin.top - settings.margin.bottom;

        let crosspie = d3.select('#' + 'svg-' + settings.id);

        // const xScale = d3.scaleLinear().domain([50, 0]).range([w - 10, 0]);
        // const yScale = d3.scaleLinear().domain([0, 50]).range([h - 10, 0]);

        let storkeWidth = 0.5;


        const team = ['red', 'green', 'blue', 'yellow', 'purple'];
        const space = w / team.length;

        crosspie.append('rect')
            .attr('width', fullW)
            .attr('height', fullH)
            .classed('background', true);

        crosspie.append('rect')
            .attr('x', 0)
            .attr('x', 0)
            .attr('width', w - storkeWidth)
            // .attr('height', h - storkeWidth)
            .attr('height', w - storkeWidth)
            .attr('rx', space * 0.5)
            .attr('ry', space * 0.5)
            // rx="20" ry="20"
            .classed('datarect', true)
            .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")


        Object.keys(team).forEach(function(vskey) {
            Object.keys(team).forEach(function(key) {

                var grid = crosspie.append('g')
                    .attr('id', team[vskey] + '-' + team[key])
                    .attr("transform", "translate(" + (+settings.margin.left + (space * key)) + "," + (settings.margin.top + (space * vskey)) + ")")

                grid.append('circle')
                    .attr('cx', space * 0.5)
                    .attr('cy', space * 0.5)
                    .attr('r', space * 0.5 * 0.8)
                    .attr('class', 'crosspie-tick')
                    // .attr("transform", "translate(" + (+settings.margin.left + (space * key)) + "," + (settings.margin.top + (space * vskey)) + ")")

                if (team[key] == team[vskey]) {
                    grid.append('circle')
                        .attr('cx', space * 0.5)
                        .attr('cy', space * 0.5)
                        .attr('r', space * 0.5)
                        .attr('class', 'fill-' + team[key])
                    grid.append('text')
                        .attr('id', 'text-' + team[vskey] + '-' + team[key])
                        .text('0')
                        .attr('class', 'crosspie-teamsize')
                        .attr("transform", "translate(" + (space * 0.5) + "," + (space * 0.5) + ")")
                }


                // console.log(team);
                // crosspie.append('circle')
                //     .attr('r', space * 0.5)
                //     .attr('class', 'fill-' + team)
                //     .attr("transform", "translate(" + ((space * (key + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")

                // crosspie.append('text')
                //     .text(data.data[team].playercount)
                //     .attr('class', 'crosspie-teamsize')
                //     .attr("transform", "translate(" + ((space * (key + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")


                // Object.keys(data.data[team].absolut).forEach(function(vsteam, vskey) {

                //     crosspie.append('circle')
                //         // .attr('r', space * 0.5)
                //         .attr('r', 5)
                //         .attr('class', 'fill-' + team)
                //         .attr("transform", "translate(" + ((space * (key + 0.5 + vskey + 0.5)) + +settings.margin.left) + "," + ((space * (key + 0.5)) + +settings.margin.top) + ")")


                // })
            })
        })





    }


    function init_radar(settings) {

        // console.log("json data: ", settings);

        const fullW = document.getElementById('svg-' + settings.id).getAttribute("pwidth");
        const fullH = document.getElementById('svg-' + settings.id).getAttribute("pheight");
        const w = fullW - settings.margin.left - settings.margin.right;
        const h = fullH - settings.margin.top - settings.margin.bottom;

        let radar = d3.select('#' + 'svg-' + settings.id);

        // const xScale = d3.scaleLinear().domain([50, 0]).range([w - 10, 0]);
        // const yScale = d3.scaleLinear().domain([0, 50]).range([h - 10, 0]);

        let storkeWidth = 0.5;

        radar.append('rect')
            .attr('width', fullW)
            .attr('height', fullH)
            .classed('background', true);

        radar.append('rect')
            .attr('width', w - storkeWidth)
            // .attr('height', h - storkeWidth)
            .attr('height', w - storkeWidth)
            .classed('datarect', true)
            .attr("transform", "translate(" + (+settings.margin.left + (storkeWidth / 2)) + "," + (settings.margin.top + (storkeWidth / 2)) + ")")

        var txt = radar.append('g').attr('class', 'radartxt')
            .attr("transform", "translate(" + (settings.margin.left + (w * 0.5)) + "," + (settings.margin.top + (w * 0.5)) + ")")

        txt.append('text').text('death at')
        txt.append('text').text('Nexus')

        var datafield = radar.append("g")
            .attr('id', settings.id + "-datafield")
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top) + ")")

        radar.append('rect')
            .attr('width', fullW)
            .attr('height', +settings.margin.top)
            .attr('x', 0)
            .attr('y', 0)
            .classed('background', true)

        radar.append('rect')
            .attr('width', +settings.margin.left)
            .attr('height', fullH)
            .attr('x', 0)
            .attr('y', 0)
            .classed('background', true)

        radar.append('rect')
            .attr('width', +settings.margin.right)
            .attr('height', fullH)
            .attr('x', w + +settings.margin.left)
            .attr('y', 0)
            .classed('background', true)

        radar.append('rect')
            .attr('width', fullW)
            .attr('height', +settings.margin.bottom + 30)
            .attr('x', 0)
            .attr('y', w + +settings.margin.top)
            .classed('background', true)


        datafield.append('line').attr('x1', 0).attr('y1', 0).attr('x2', w).attr('y2', w).attr('class', 'radartick')
        datafield.append('line').attr('x1', w).attr('y1', 0).attr('x2', 0).attr('y2', w).attr('class', 'radartick')

        // datafield.append('circle').attr('cx', w * 0.5).attr('cy', w * 0.5).attr('r', w * 0.5).attr('class', 'radartick')
        // datafield.append('circle').attr('cx', w * 0.5).attr('cy', w * 0.5).attr('r', w * 0.25).attr('class', 'radartick')

        // datafield.append('circle').attr('cx', 0).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w)).attr('class', 'radartick')
        // datafield.append('circle').attr('cx', w).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w)).attr('class', 'radartick')
        // datafield.append('circle').attr('cx', 0).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w)).attr('class', 'radartick')
        // datafield.append('circle').attr('cx', w).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w)).attr('class', 'radartick')

        datafield.append('circle').attr('cx', 0).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.25)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.25)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', 0).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.25)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.25)).attr('class', 'radartick')

        datafield.append('circle').attr('cx', 0).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.5)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.5)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', 0).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.5)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.5)).attr('class', 'radartick')

        datafield.append('circle').attr('cx', 0).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.75)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', 0).attr('r', ((1 / Math.SQRT2) * w * 0.75)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', 0).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.75)).attr('class', 'radartick')
        datafield.append('circle').attr('cx', w).attr('cy', w).attr('r', ((1 / Math.SQRT2) * w * 0.75)).attr('class', 'radartick')


        radar.append('g').attr('class', 'fill-red').html(icon['nexus'])
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top) + ") scale(0.3)")

        radar.append('g').attr('class', 'fill-green').html(icon['nexus'])
            .attr("transform", "translate(" + (settings.margin.left + w) + "," + (settings.margin.top) + ") scale(0.3)")

        radar.append('g').attr('class', 'fill-blue').html(icon['nexus'])
            .attr("transform", "translate(" + (settings.margin.left) + "," + (settings.margin.top + w) + ") scale(0.3)")

        radar.append('g').attr('class', 'fill-yellow').html(icon['nexus'])
            .attr("transform", "translate(" + (settings.margin.left + w) + "," + (settings.margin.top + w) + ") scale(0.3)")

    }

    function init() {

        d3.select('#annilyser-logo').html(annilyserlogo);


        Object.keys(init_slots).forEach(function(key, _) {
            // if (init_slots[key] === 'linechart') initLinechart(graphic, key);

            let o = document.getElementById(key).getClientRects()[0];
            // console.log("getClientRects[0]", o);
            // console.log(init_slots[key].id + " clientHeight", document.getElementById(key).clientHeight);
            // console.log(init_slots[key].id + " clientWidth", document.getElementById(key).clientWidth);
            // console.log(init_slots[key].id + " offsetHeight", document.getElementById(key).offsetHeight);
            // console.log(init_slots[key].id + " offsetWidth", document.getElementById(key).offsetWidth);

            d3.select('#' + key)
                .append('svg')
                .attr('id', 'svg-' + key)
                .attr('width', '100%').attr('height', '100%')
                .attr('pwidth', o.width).attr('pheight', o.height);

            if (init_slots[key].init == "scatter") init_scatter(init_slots[key]);
            if (init_slots[key].init == "doubledonut") init_doubledonut(init_slots[key]);
            if (init_slots[key].init == "nexusradar") init_radar(init_slots[key]);
            // if (init_slots[key].init == "crosspie") init_crosspie(init_slots[key]);
            // if (init_slots[key].init == "menlist") init_menlist(init_slots[key]);
            // if (init_slots[key].init == "nodegraph") init_nodes(init_slots[key]);

        });

    }
</script>

</html>